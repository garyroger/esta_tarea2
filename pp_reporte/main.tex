\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb}
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage[hidelinks]{hyperref}
\usepackage{pgfplots}
\usepackage{tickz}
\pgfplotsset{compat=1.18}

\title{Guia de configuracion del bloque \emph{Synchronous Machine pu (Fundamental)} en Simscape}

\begin{document}
\maketitle

\section{Datos de dise\~no (Appendix B)}
\begin{center}
\begin{tabular}{ll}
\toprule
Potencia nominal & \(P_n=\SI{6250}{kVA}\)\\
Tensi\'on nominal L-L & \(V_n=\SI{4160}{V}\)\\
Frecuencia & \(f_n=\SI{60}{Hz}\)\\
Factor de potencia & \(0.85\)\\
N\'umero de polos & \(20\Rightarrow\) pares \(p=10\)\\
Resistencia de estator & \(r_s=0.00636\) pu\\
Inductancia de fuga de estator & \(x_{ls}=0.1235\) pu\\
Amortiguador d: & \(r_{kd}=0.03578\) pu,\; \(x_{lkd}=0.1119\) pu\\
Amortiguador q: & \(r_{kq1}=0.05366\) pu,\; \(x_{lkq1}=0.1678\) pu\\
Campo: & \(r_{fd}=0.0084\) pu,\; \(x_{lfd}=0.2691\) pu\\
Inercia & \(H=\SI{7.11}{s}\)\\
\bottomrule
\end{tabular}
\end{center}

\section{Configuraci\'on del bloque en Simulink}
Abra el bloque \texttt{Synchronous Machine pu Fundamental} y seleccione la pesta\~na \textbf{Parameters}. Ingrese:

\paragraph{Nominal power, voltage, frequency and poles}
\[
P_n=\SI{6.25e6}{VA},\quad V_n=\SI{4160}{V_{rms}},\quad f_n=\SI{60}{Hz},\quad p=10.
\]

\paragraph{Stator \([R_s, L_l, L_{md}, L_{mq}]\)}
\[
R_s=r_s,\quad L_l=x_{ls},\quad L_{md}=\text{(a estimar)},\quad L_{mq}=\text{(a estimar)}.
\]
\emph{Nota:} en el modelo p.u. de Simscape, \(L\) y \(X\) en p.u. son num\'ericamente iguales porque \(\omega_\text{base}=1\) p.u.

\paragraph{Field \([R_f, L_{lfd}]\)}
\[
R_f=r_{fd},\qquad L_{lfd}=x_{lfd}.
\]

\paragraph{Dampers \([R_{kd}, L_{lkd}, R_{kq1}, L_{lkq1}]\)}
\[
R_{kd}=r_{kd},\;\; L_{lkd}=x_{lkd},\qquad R_{kq1}=r_{kq1},\;\; L_{lkq1}=x_{lkq1}.
\]

\paragraph{Inertia and friction}
\[
H=\SI{7.11}{s},\quad \text{friction }F=0.
\]

\paragraph{Inicial conditions} deje en cero, excepto \(V_f\) si desea fijar una excitaci\'on inicial (modo manual).

\section{Estimaci\'on de \(L_{md}\) y \(L_{mq}\)}
El art\'iculo reporta (v\'ia pruebas din\'amicas) las \textbf{reactancias equivalentes} \(X_d,X_d',X_d''\) y \(X_q,X_q''\), y las \textbf{constantes de tiempo} \(T'_{do},T''_{do},T''_{qo}\).
Con los datos de dise\~no (fugas y resistencias) y esas mediciones, podemos obtener \(L_{md}\) y \(L_{mq}\).

\subsection*{Relaciones en eje \(d\)}
Con campo y un amortiguador en \(d\):
\begin{align}
X_d      &= X_{ls} + L_{md},\label{eq:Xd}\\
X_d'     &= X_{ls} + \frac{L_{md}\,L_{lfd}}{L_{md}+L_{lfd}},\label{eq:Xdprime}\\
X_d''    &= X_{ls} + \frac{L_{md}\,L_{lkd}}{L_{md}+L_{lkd}}.\label{eq:Xdpp}
\end{align}
Despejes \'utiles (a partir de \eqref{eq:Xdpp} y \eqref{eq:Xdprime}):
\begin{align}
L_{md} &= \frac{(X_d''-X_{ls})\,L_{lkd}}{L_{lkd}-(X_d''-X_{ls})},\label{eq:Lmd1}\\
L_{md} &= \frac{(X_d'-X_{ls})\,L_{lfd}}{L_{lfd}-(X_d'-X_{ls})}.\label{eq:Lmd2}
\end{align}
La ecuaci\'on \eqref{eq:Xd} verifica coherencia en estado estacionario.

subsection*{Relaciones en eje \(q\)}
Con un amortiguador en \(q\):
\begin{align}
X_q      &= X_{ls} + L_{mq},\label{eq:Xq}\\
X_q''    &= X_{ls} + \frac{L_{mq}\,L_{lkq1}}{L_{mq}+L_{lkq1}}.\label{eq:Xqpp}
\end{align}
Despeje:
\begin{equation}
L_{mq} = \frac{(X_q''-X_{ls})\,L_{lkq1}}{L_{lkq1}-(X_q''-X_{ls})},
\quad\text{y comprobar con }L_{mq}=X_q-X_{ls}.
\end{equation}

\subsection*{Comprobaci\'on con constantes de tiempo}
Para verificar (o ajustar levemente \(R\) de amortiguadores/campo), use:
\begin{align}
T'_{do} &\approx \frac{L_{md}+L_{lfd}}{R_f}\cdot\frac{L_{lfd}}{L_{md}+L_{lfd}},\\
T''_{do}&\approx \frac{L_{md}+L_{lkd}}{R_{kd}}\cdot\frac{L_{lkd}}{L_{md}+L_{lkd}},\\
T''_{qo}&\approx \frac{L_{mq}+L_{lkq1}}{R_{kq1}}\cdot\frac{L_{lkq1}}{L_{mq}+L_{lkq1}}.
\end{align}
Si los tiempos calculados difieren sensiblemente de los medidos, ajuste ligeramente \(R_{kd}\) o \(R_{kq1}\) (procedimiento de identificaci\'on).


% =========================
% figura 1: escala lineal
% =========================
\begin{tikzpicture}
\begin{axis}[
  width=12cm, height=6cm,
  xlabel={tiempo t},
  ylabel={corriente i(t)},
  xmin=0, xmax=5,
  ymin=0, ymax=1.25,
  grid=both,
  legend style={draw=none,at={(0.98,0.95)},anchor=north east,font=\small},
  every axis plot/.style={thick}
]
% --- curva sintetica con dos exponentes (subtransitorio + transitorio)
% i(t) = i_ss + a*exp(-t/Tsub) + b*exp(-t/Ttr)
\addplot+[domain=0:5,samples=600] ({x},{0.25 + 0.7*exp(-x/0.3) + 0.3*exp(-x/1.2)});
\addlegendentry{envolvente i(t)}

% --- anotar zonas
\addplot[<->,gray,thick,mark=none] coordinates {(0.2,1.0) (1.2,0.55)};
\node[fill=white,inner sep=1pt] at (axis cs:0.7,0.8) {subtransitorio};
\addplot[<->,gray,thick,mark=none] coordinates {(1.5,0.6) (3.5,0.35)};
\node[fill=white,inner sep=1pt] at (axis cs:2.5,0.475) {transitorio};

% --- marcas de niveles a/b/c (opcional)
\addplot[dashed,gray,mark=none] coordinates {(0,1.0) (5,1.0)};
\node[gray] at (axis cs:4.8,1.03) {\small nivel inicial (cercano a x''d)};
\addplot[dashed,gray,mark=none] coordinates {(0,0.55) (5,0.55)};
\node[gray] at (axis cs:4.6,0.58) {\small transitorio};
\addplot[dashed,gray,mark=none] coordinates {(0,0.25) (5,0.25)};
\node[gray] at (axis cs:4.6,0.28) {\small estacionario (x_d)};

\end{axis}
\end{tikzpicture}

\vspace{6mm}

% =========================================
% figura 2: semilog-y con 1h y 2h marcados
% =========================================
\begin{tikzpicture}
\begin{semilogyaxis}[
  width=12cm, height=6cm,
  xlabel={tiempo t},
  ylabel={i(t) (escala log)},
  xmin=0, xmax=5,
  ymin=1e-2, ymax=2,
  grid=both,
  legend style={draw=none,at={(0.03,0.97)},anchor=north west,font=\small},
  every axis plot/.style={thick},
]
% curva real (misma que arriba pero en semilog y)
\addplot+[domain=0:5,samples=600] ({x},{0.25 + 0.7*exp(-x/0.3) + 0.3*exp(-x/1.2)});
% --- tramo subtransitorio: ajustamos recta en semilog (t pequeÃ±o)
% para efecto visual, trazamos la recta log-equivalente y su interseccion en t=0 (2h)
\addplot[domain=0:1, samples=2, dashed, blue] ({x},{exp(ln(0.25+0.7+0.3) - x/0.3)});
\node[blue] at (axis cs:0.25,1.3) {\small recta subtransitoria};

% interseccion t=0 de la recta subtransitoria -> "2h"
\addplot[only marks,mark=*,blue] coordinates {(0,1.25)};
\node[blue,anchor=west] at (axis cs:0.05,1.25) {\small 2h};

% --- tramo transitorio: recta en semilog (t mediano)
\addplot[domain=0.6:3.5, samples=2, dashed, red] ({x},{exp(ln(0.55) - (x-0.6)/1.2)});
\node[red] at (axis cs:1.8,0.5) {\small recta transitoria};

% interseccion t=0 de la recta transitoria -> "1h"
\addplot[only marks,mark=*,red] coordinates {(0,exp(ln(0.55) + 0.6/1.2))};
\node[red,anchor=west] at (axis cs:0.05,exp(ln(0.55)+0.6/1.2)) {\small 1h};

% --- guia al origen temporal (t=0)
\addplot[densely dotted,black,mark=none] coordinates {(0,1e-2) (0,2)};
% --- guia al origen temporal (t=0)
\draw[densely dotted] (axis cs:0,1e-2) -- (axis cs:0,2);

\end{semilogyaxis}
\end{tikzpicture}

\end{document}

